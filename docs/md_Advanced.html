<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Dim: Advanced Topics</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Dim<span id="projectnumber">&#160;1.0</span>
   </div>
   <div id="projectbrief">Compile time dimensional analysis</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_Advanced.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Advanced Topics</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md51"></a> </p>
<h1><a class="anchor" id="autotoc_md52"></a>
Metaprogramming with Quantities</h1>
<p>One pitfall for C++ class templates is that each instantiation is a totally independent class at run time with no relation to any other instantiation. Thus <code>si::Length</code> and <code>si::Time</code> are no more related than <code>std::string</code> and <code>double</code>. This is often painful for code that wants to handle these types in a uniform way. To aid with this, Dim provides a macro <code>DIM_IS_QUANTITY</code> that works with the C++ Substitution Failure is not an Error (SFINAE &ndash; this language has the <em>worst</em> jargon). <br  />
 It works like this </p><div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> Q, DIM_IS_QUANTITY(Q)&gt;</div>
<div class="line"><span class="keywordtype">char</span>* print_quantity(<span class="keywordtype">char</span>* o_quant_str, Q <span class="keyword">const</span>&amp; q)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> offset = sprintf(o_quant_str, <span class="stringliteral">&quot;%g_&quot;</span>, <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(q.value));</div>
<div class="line">    print_unit(o_quant_str+offset, q);</div>
<div class="line">    <span class="keywordflow">return</span> o_quant_str;</div>
<div class="line">}</div>
</div><!-- fragment --><p> The print_quantity function template is thus only defined for quantity types, where we know <code>q</code> will have a member <code>value</code>.</p>
<h1><a class="anchor" id="autotoc_md53"></a>
Micro-Optimization for Nondimensionalization</h1>
<p>If you need to nondimensionalize a quantity say for serialization, you may want to squeeze out all the performance you can while still using the facilities of Dim to catch errors. For example, here are three ways to nondimensionalize a length: </p><div class="fragment"><div class="line">Length L = 2_m;</div>
<div class="line"><span class="keywordtype">double</span> v1 = dimensionless_cast(L); <span class="comment">// 1</span></div>
<div class="line"><span class="keywordtype">double</span> v1 = L / meter; <span class="comment">// 2</span></div>
<div class="line"><span class="keywordtype">double</span> v2 = L / meter_; <span class="comment">// 3</span></div>
</div><!-- fragment --><p> (1) is an unchecked access and can be unsafe. (2) does just what it says, provide the length of L in meters. However, since <code>meter</code> is itself a Length quantity, this actually performs a floating point division (2.0/1.0). (3) uses the specially defined <em>unit</em> types (these are the same as the quantities but have a trailing underscore). The <code>operator/</code> action here understands that a unit has, well, <em>unit</em> value, so avoids the division. In fact, at runtime, (1) and (3) produce the same machine instructions.</p>
<h1><a class="anchor" id="autotoc_md54"></a>
Fractional Dimensions</h1>
<p>Dim does not support fractional dimension like "m^1/2" that are used in some domains. Supporting these really complicates the metaprogramming and makes your program compile slower. You can typically work with e.g. squared quantities to obtain integer dimensions. (If your application has fractal dimensions, why are you using this library at all?) If this is too much of a burden, the <a href="https://www.boost.org/doc/libs/1_80_0/doc/html/boost_units.html">boost::units</a> library provides this feature.</p>
<h1><a class="anchor" id="autotoc_md55"></a>
Bad Quantities and NaN</h1>
<p>When <code>__FAST_MATH__</code> is defined, Dim uses an expanded notion of a "bad" floating point number that includes numbers that are Inf, -Inf, and NaN in IEEE 754 floating point. The rationale is that on embedded systems (ARM in particular), you often must compile with <code>-Ofast</code> to obtain access to SIMD instructions. When you do this, <code>std::isnan()</code> always evaluates to false. Dim uses its own <code>is_bad()</code> function to work around this. The trade-off is that algorithms relying on correct behavior with Inf will see values as "bad". But such algorithms are usually limited to specialized scientific codes rather than the more general robotics and engineering codes Dim is intended for.</p>
<p>Note if <code>__FAST_MATH__</code> isn't defined, then <code>is_bad()</code> is an alias for <code>isnan()</code>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
